---
title: 操作系统概述
date: 2023-07-29 11:14 
categories:
- 计算机基础
tags:
---
<head>
  <meta name="referrer" content="no-referrer" />
</head>



## 概念

操作系统逻辑上来说是硬件资源的管理者，实际来说操作系统是一个软件。

## 特征

并发和共享是操作系统两个最基本特征。

- 并发

  并发(ConCurrency)：多个事件在同一时间间隔内发生，也就是说微观上其实是分时交替执行

  并行(Parallelism)：多个事件在同一时刻发生

  > 即使是单处理器操作系统也能实现并发。
  >
  > 但是实现并行性需要相关硬件支持，例如采用多个处理器或者多流水线。

- 共享

  - 互斥共享

    资源一段时间内只能允许一个进程访问，这种资源称为临界资源。

  - 同时访问

    指的是宏观上，资源看起来像是被多个进程同时使用，微观上其实还是分时交替访问。

- 虚拟

  虚拟指操作系统可以把一个物理上的实体变为若干个逻辑上的对应物。

- 异步

  指的是操作系统的进程执行是异步的，也就是由于资源的共享性，进程以不可预知的速度向前推进。

## 功能

- 进程管理
- 存储器管理
- 文件管理
- 设备管理

## 提供的服务

- 接口服务

  - 命令接口

    - 联机命令接口(Online)

      又称交互式命令接口，适用分时或实时系统的接口。例如Linux命令

    - 脱机命令接口(Offline)

      又成批处理命令接口，适用于批处理系统。例如bat文件里面一批控制命令，用户不能干预作业运行。

  - 程序接口

    又称系统调用，**广义指令**。用户在程序中使用这些程序接口请求操作系统服务。例如GUI图形接口

## 发展历程

- 手工操作阶段(无操作系统)

  所有工作都需要手工完成。

  缺点：用户独占全机，资源利用率低

- 批处理操作系统

  - 单道批处理系统

    一次只能执行一个任务。当一个任务完成或发生错误时，才会开始执行下一个任务。

    缺点：当前作业I/O阶段，CPU处于空闲，利用率低

  - 多道批处理系统

    多道批处理系统允许同时加载多个任务到内存中，并允许它们在不同的时间段内交替执行(并发性)。

    优点：资源利用率高。

    缺点：用户响应时间长，且不提供人机交互能力。

  > 通道是指主存储器和外部设备之间进行数据传输的硬件。例如DMA方式中通道即DMA控制器

- 分时操作系统

  将处理器的运行时间分成多个时间片，按时间片轮流把处理器分配给各进程使用。分时操作系统也支持多道批处理，同时具有**交互性**。

- 实时操作系统

  专注于处理实时任务，这些任务对时间要求非常严格。

  - 硬实时系统：硬实时任务必须绝对在预定的时间内完成
  - 软实时系统：软实时任务偶尔可以违反时间规定
  
  > 进程调度采用抢占式优先级调度算法

## 运行环境

- 内核态(管态)

  程序在内核态下可以执行操作系统内核程序，比如特权指令。当然也可以执行非特权指令。

- 用户态(目态)

  程序在用户态下只能执行非特权指令，防止对系统软硬件资源造成破坏

- 用户态和内核态之间的切换

  - 用户态->内核态

    - 应用程序需要访问系统服务时，使用访管指令(又称陷入指令或trap指令)，从而产生一个中断事件转换为核心态

      > 访管指令**仅**在用户态下执行，故为非特权指令

  - 内核态->用户态

    - 操作系统恢复现场及屏蔽字，通过中断返回指令IRET返回

- 内核内容

  - 时钟管理

    包括计时，利用时钟中断实现进程切换等功能

  - 中断机制

  - 原语

    是一组最基本的、不可再分的操作，用于控制和管理计算机系统的各种资源和功能。例如创建进程，文件读写

## 结构

- 分层法

  最底层(层0)是硬件，最高层(层N)为用户接口。

  优点：便于系统调试和验证，简化实现；易于扩充和维护

  缺点：合理定义各层很难；效率较低

- 模块化

  将功能划分成若干个独立模块。

  优点：提高维护性；增强操作系统兼容性

  缺点：很难满足模块间耦合

- 宏内核

  也称为单内核或大内核，将系统的主要功能都放入内核态。

  优点：性能较高

  缺点：复杂性较高

- 微内核

  只将部分核心功能放入内核态

  优点：可靠性高，复杂程度低

  缺点：性能较差

## 提高部分

### 中断处理过程

1. 关中断：保证CPU在保护程序现场状态时不被中断
2. 保存断点：为保证中断完成可以返回，必须将原来程序的断点(即程序计数器PC)保存起来
3. 引出中断服务程序：取出中断服务程序的入口地址送入PC
4. 保存现场和屏蔽字：进入中断服务程序后，首先要保存现场，一般是指程序状态字寄存器PSWR和某些通用寄存器的内容
5. 开中断：允许更高级的中断请求得到响应
6. 执行中断服务程序
7. 关中断：保证在恢复现场和屏蔽字时不被中断
8. 恢复现场和屏蔽字：恢复程序中断前的状态
9. 开中断，中断返回：中断服务程序的最后一条指令是中断返回指令。

### 中断在软件和硬件方面的体现

- 硬件方面(计组)
  - 中断信号是由硬件产生的电信号
  
  - 中断向量表：中断向量指明中断服务程序入口，中断向量存放在中断向量表中。
  
  - 中断控制器：负责多个中断请求优先级和状态管理的硬件组件
  
  - 中断发生时的**保存断点(程序计数器PC)**，保存PSW，关中断，识别中断源等操作均由硬件完成
  
    > PSW(R)，Process Status Word (Register)，程序状态字，一种寄存器
  
- 软件方面(操作系统)
  - 中断发生后，操作系统会**保存通用寄存器内容**，**初始化中断向量表**并调用**中断服务程序**(ISR)来处理中断
  - 对于I/O中断，操作系统还会驱动设备来处理中断
  - 对于时钟中断，操作系统可能决定进行进程切换
  - 对于异常(内中断)，操作系统也会进行处理
  - 对于程序的系统调用，操作系统会通过软件中断处理

### 中断发生的时机

CPU的中断信号可以在指令周期或任意时刻发生，取决于不同的中断信号。

- 指令周期中发生的中断

  表示中断信号与当前指令密切相关，如故障，陷阱和中止，也就是异常(内中断)。其中故障和中止需要立即响应中断，陷阱需要在当前指令执行完毕后响应中断。

- 任意时刻发生的中断

  表示中断信号与当前指令无关，如I/O设备操作，主存校验错和电源故障等，也就是中断(外中断)。I/O设备操作可以推迟n个指令再响应，属于可屏蔽中断。主存校验错和电源故障需要立即响应，属于不可屏蔽中断。
