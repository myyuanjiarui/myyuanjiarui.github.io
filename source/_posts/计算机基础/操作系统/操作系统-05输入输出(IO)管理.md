---
title: 输入/输出(I/O)管理
date: 2023-07-29 11:14 
categories:
- 计算机基础
tags:
---
<head>
  <meta name="referrer" content="no-referrer" />
</head>




## I/O管理概述

### I/O控制方式

指的是控制设备和内存或CPU之间的数据传送。

- 程序直接控制方式

  CPU对外设进行循环检查，非常浪费CPU资源。根本原因在于CPU未采用中断机制，使得I/O设备无法向CPU报告它已完成的字符输入输出操作。

  <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231022143231509.png" alt="image-20231022143231509" style="zoom: 50%;float:left" />

- 中断驱动方式

  中断驱动方式比程序直接控制方式有效，但是仍然会消耗较多CPU资源。

  <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231022143544357.png" alt="image-20231022143544357" style="zoom:50%;float:left" />

- DMA方式

  基本思想是在I/O设备和内存间开辟直接的数据交换同理，解放CPU，CPU只需要在数据块传送的开始和结束时，才需要CPU干预。

  DMA方式的特点：

  - 基本单位是数据块
  - 数据直接在设备与内存之间传递

- I/O通道方式

  是DMA方式的发展，可进一步减少CPU的干预，即把对一个数据块的读(或写)为单位的干预，减少为对一组数据块的干预。

  I/O通道方式与DMA方式的区别：DMA方式需要CPU来控制传输的数据块大小位置，而通道方式中这些信息由通道控制。另外，每个DMA控制器对应一台设备与内存传递数据，而一个通道可以控制多台设备与内存的数据交换

### I/O软件层次结构

<img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231022145130856.png" alt="image-20231022145130856" style="zoom:80%;" />

- 用户层I/O软件

  实现与用户交互的接口，用户层必须通过一组系统调用来获取操作系统服务

- 设备独立性软件

  设备独立性也称设备无关性。引入逻辑设备和物理设备的概念。使用逻辑设备名来请求某类设备，在实际系统执行时，必须将逻辑设备名映射成物理设备名。

  设备独立性软件主要完成以下功能：执行所有设备的公有操作，向用户层(或文件层)提供统一接口。这些操作与具体的设备无关。

- 设备驱动程序

  与设备直接相关，每类设备配置一个设备驱动程序，负责具体实现系统对设备发出的操作指令，驱动I/O设备工作。

- 中断处理程序

  用于保存被中断进程的CPU环境。

## I/O核心子系统

### I/O调度概念

调度一组I/O请求就是确定一个合适的顺序来执行这些请求。

### 高速缓存与缓冲区

- 磁盘高速缓存技术

  用内存中的存储空间来暂存从磁盘中读取的数据块

- 缓冲区

  - 引入缓冲区的目的

    - 缓和CPU与I/O设备间速度不匹配的矛盾
    - 减少对CPU中断频率
    - 解决数据粒度不匹配的问题
    - 提高CPU和I/O设备之间的并行性

  - 单缓冲区

    <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231022154835649.png" alt="image-20231022154835649" style="zoom:80%;" />

    T为磁盘把一块数据输入到缓冲区的时间。M为操作系统将缓冲区数据传送到工作区。CPU对这一块数据处理的时间C。

    假设初始状态是工作区满，缓冲区空。则回到初始状态的一个周期是max(C,T)+M.

    > 只有缓冲区装满后，用户才能从缓冲区取数据。

  - 双缓冲区

    ![image-20231022155118944](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231022155118944.png)

    如果缓冲区2满了，用户可以从缓冲区2中取数据，同时I/O设备可以向缓冲区1中装数据。提高CPU和设备的并行性。

    假设初始状态是缓冲区2满，工作区和缓冲区1为空。回到下一个状态(缓冲区1满，缓冲区2和用户区空)一个周期的时间是max(C+M,T).

  - 循环缓冲

    设置多个缓冲区相互链接形成一个环，设置in指针和out指针分别指明设备输入的缓冲区和用户读取的缓冲区

  - 缓冲池

    由多个系统公用的缓冲区组成一个缓冲池。

- 高速缓存和缓冲区的比较

  |          | 高速缓存                                                     | 缓冲区                                                       |
  | -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | 相同点   | 介于高速设备和低速设备之间                                   | 介于高速设备和低速设备之间                                   |
  | 存放数据 | 高速缓存中存放的数据是某些数据的复制                         | 不存放数据的复制，直接传送                                   |
  | 目的     | 高速缓存存放的是高速设备经常要访问的数据，如果找不到，就需要访问低速设备 | 高速设备和低速设备的所有通信都要经过缓冲区，高速设备永远不会直接访问低速设备。 |

  

