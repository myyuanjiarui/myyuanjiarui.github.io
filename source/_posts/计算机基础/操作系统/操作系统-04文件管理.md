---
title: 文件管理
date: 2023-07-29 11:14
description: 考研时王道408的学习笔记 
categories:
- 计算机基础
tags:
---
<head>
  <meta name="referrer" content="no-referrer" />
</head>



## 文件系统基础

### 文件的逻辑结构

- 无结构文件

  数据无结构，只能按照顺序流访问。

- 有结构文件

  按记录的组织形式分类：

  - 顺序文件

    一个文件内的记录按某种顺序一个接一个地顺序排列。顺序文件可分为以下两种结构：

    - 串结构：按存入的时间先后进行排列
    - 顺序结构：按文件中所有记录的关键字顺序排序，可采用折半查找

  - 索引文件

    按照文件中一个记录的存储空间是否可变：

    - 定长记录文件

      支持随机查找，根据记录号可以直接找到记录号在该文件内的地址。

    - 变长记录文件

      不支持随机查找，只能顺序从头查找。

      - 改进：建立一张每个记录首地址的索引表，索引表是定长记录的顺序文件，支持随机检索，再根据索引表内容访问文件的记录。缺点是索引表可能比较占内存。

  - 索引顺序文件

    结合顺序文件和索引文件的优点。将顺序文件中的所有记录分成若干组，索引表中每一项记录一组的首地址，查找文件记录时，先通过索引文件找到其所在的组，然后在该组中使用顺序查找。

  - 直接文件和散列文件

    通过给定记录的键值和散列函数直接确定记录的物理地址。这种文件结构没有顺序的特性。

### 文件的物理结构

- 连续分配

  即每个文件在磁盘上占有一组连续的块。

  <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231113153645851.png" alt="image-20231113153645851" style="zoom:80%;" />

  文件的目录项中“文件物理地址”字段应存放文件的开始地址和长度。

  支持顺序和直接访问。

  优点：实现简单，存取速度快

  缺点：文件长度不宜动态增加；反复增删文件后会产生外部碎片；很难确定一个文件需要的实际大小。

- 链接分配

  采用离散分配的方式。分为隐式链接和显式链接

  - 隐式链接

    <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231113154111229.png" alt="image-20231113154111229" style="zoom:80%;" />

    目录项中只含有该文件的第一块和最后一块指针，除最后一个盘块外，所有盘块都含有指向文件下一个盘块的指针。每个文件对应一串磁盘块的链表。

    优点：**解决了连续分配中存在外部碎片的问题**。

    缺点：只适合顺序访问；稳定性不佳，容易出现文件丢失。

  - 显式链接

    把用于链接各物理块的指针取出，显示的存放到内存的一张链接表中，称为文件分配表(File Allocation Table，FAT)，该表在整个磁盘中只有一张。

    ![image-20231113154601172](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231113154601172.png)

    文件的第一个盘块存储在文件目录的"物理地址"字段中，后续盘块通过查FAT表实现。

    缺点：FAT表可能占有比较大的内存空间

- 索引分配

  实际上，在打开文件时只需要调入该文件对应的盘块即可，无需将整个FAT表调入内存。索引分配将文件的所有盘块存放在一起构成一个单独的索引块。文件目录的"物理地址"字段只存放索引块所对应的物理地址。

  <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231113155026123.png" alt="image-20231113155026123" style="zoom:80%;" />

  优点：索引分配支持直接访问，索引块中的第i个条目对应文件的第i块。

  缺点：单级索引可能导致索引块过大，多级索引需要多次访存，降低了文件的存取速度。

  - 混合索引分配

    对于小文件，将其盘块地址直接放入FCB，称为直接寻址；对于中文件，采用单级索引；对于大文件，可采用多级索引。

    ![image-20231113155544402](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231113155544402.png)

    

### 目录结构

- 文件控制块(FCB)

  用来存放控制文件需要的各种信息。FCB的有序集合称为文件目录，一个FCB就是一个文件目录项。一个文件目录也被视为一个文件，称为目录文件。

- 索引结点

  将FCB分成文件名和文件其他描述信息两部分，可以加快查找文件的速度，文件其他描述信息单独形成一个称为**索引结点**的数据结构，简称iNode，每个文件的FCB只由文件名和指向iNode的指针构成。

  根据索引结点的存放位置分为磁盘索引结点和内存索引结点。

- 单级目录结构

  整个系统只建立一张目录表。

  ![image-20231018214310107](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231018214310107.png)

  缺点：查找速度慢，不允许文件重名，不便于文件共享

- 两级目录结构

  将文件目录分为主文件目录和用户文件目录两级。主文件目录记录用户名和对应用户文件目录所在的存储位置。用户文件目录记录该用户文件的FCB。

  ![image-20231018214530847](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231018214530847.png)

  优点：解决了文件重名的问题

  缺点：缺乏灵活性，不能对文件分类

- 树形目录结构

  <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231018214638047.png" alt="image-20231018214638047" style="zoom:80%;" />

  存在相对路径和绝对路径。相对路径可以加快文件搜索。

  优点：解决重名，便于分类

  缺点：不便于文件共享

- 无环图目录结构

  <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231018214812408.png" alt="image-20231018214812408" style="zoom:80%;" />

  为共享文件设置共享计数器count，只有共享计数器值为0时，才可以真正删除共享文件。

  缺点：系统管理复杂

### 文件共享

- 基于索引结点的共享方式(硬链接)

  多用户目录项都链接到共享文件的索引结点，同时还需要在索引结点中设置count计数器。

  <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231018215558560.png" alt="image-20231018215558560" style="zoom:80%;" />

- 利用符号链实现文件共享(软链接)

  系统创建一个LINK类型的新文件，只包含要被链接文件F的路径名，将该文件加入用户的目录中，当系统访问该文件时，会根据文件中的路径名去找到文件F。

  在软链接中，共享文件的用户不拥有指向共享文件索引结点的指针，只拥有该文件的路径名。软链接每次访问要多次读取磁盘，因此硬链接的查找速度更快。

### 文件的保护

文件保护通过口令保护，加密保护和访问控制实现。

- 口令保护

  用户在建立一个文件时提供一个口令，用户请求访问时必须提供相应的口令。

  优点：时空开销不大

  缺点：口令直接存在系统内部，不够安全

- 加密保护

  用户对文件访问时需要使用密钥。

  优点：安全

  缺点：编码和译码需要耗费一定时间。

- 访问控制

  给FCB种加入访问列标。规定可访问的用户和用户组。

## 文件系统实现

### 文件系统层次结构

<img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231021201434566.png" alt="image-20231021201434566" style="zoom: 67%;float:left" />

### 目录实现

- 线性列表实现

  利用线性表的方式将文件目录项链接形成目录。

- 哈希表实现

  采用哈希函数，直接根据文件名得到目录项的地址

### 文件实现

- 虚拟文件系统

  为用户程序提供了文件系统操作的统一接口。

  ![image-20231022162040735](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231022162040735.png)

- 分区和安装

  一个磁盘可以分多个区，每个区都可以用于创建单独的文件系统

## 磁盘组织与管理

### 磁盘的结构

<img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231021214330520.png" alt="image-20231021214330520" style="zoom:67%;float:left" />

- 磁道：磁盘盘面上存储数据的同心圆
- 扇区：一个磁道划分成若干扇区
- 盘块：一个扇区称为一个盘块

磁盘地址用"柱面号·盘面号·扇区号"表示

### 磁盘调度算法

- 一次磁盘读写的时延

  由寻找(寻道)时间、旋转延迟时间和传输时间决定

  - 寻找时间Ts：寻找到数据所在磁道所需要的时间。这个时间除跨越n条磁道的时间外，还包括启动磁臂的时间
  - 旋转延迟时间Tr：磁头定位到某一磁道的扇区所需要的时间。设磁盘转速为r，则Tr=1/(2r)
  - 传输时间Tt：从磁盘读写数据的时间，取决于每次所读的字节数和磁盘转速，Tt=b/(rN)。b为每次所读的字节数，r为磁盘转速，N为一个磁道上的字节数

- 磁盘调度算法

  - 先来先服务(FCFS)：即按照请求顺序访问磁道

  - 最短寻找时间优先(SSTF)：从所有请求磁道中，优先服务离当前磁道最近的磁道。可能会出现"饥饿"现象

  - 扫描(SCAN)算法/电梯调度算法

    在SSTF的基础上添加了移动方向，即在当前磁头移动方向上选择最近的磁道作为下一次服务的对象。注意需要移动到端点。

    ![image-20231021220233798](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231021220233798.png)

  - 循环扫描(C-SCAN)算法

    在电梯调度算法的基础上规定回返时直接回到起始段而不服务任何请求。

    ![image-20231021220524452](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231021220524452.png)
  
  - LOOK调度算法
  
    对SCAN算法的改进，只需要到达最远端的一个请求即可返回，不需要到达磁盘端点
  
    ![image-20231022160842533](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231022160842533.png)
  
  - C-LOOK调度
  
    在LOOK调度的基础上改进。
  
    ![image-20231114214613926](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231114214613926.png)
  
    > 若无特别说明，935默认SCAN算法和C-SCAN算法为LOOK和C-LOOK算法。

### 磁盘的管理

- 磁盘初始化

  - 低级初始化(物理初始化)
    - **将磁盘分成扇区**
    - 为每个扇区采用特别的数据结构，包括校验码
  - 高级初始化(逻辑初始化)
    - **创建文件系统根目录**
    - 初始化保存空闲磁盘块的数据结构

- 分区

  为了提高效率，操作系统将多个相邻的扇区组合在一起，形成一簇(在Linux中称为块)。一簇只能存放一个文件的内容，文件所占的空间只能是簇的整数倍，即使文件大小小于一簇，也要占用一簇的空间。

- 引导块

- 坏块

  用某些机制让系统不适用坏块

# 提高部分

- 系统启动过程的执行顺序

  ROM引导程序->磁盘引导程序->分区引导程序->操作系统初始化程序

- 磁盘制作为启动盘的顺序

  磁盘的物理格式化->对磁盘进行分区->磁盘的逻辑格式化->操作系统的安装







