---
title: 输入输出(I/O)系统
date: 2023-07-29 11:14 
categories:
- 计算机基础
tags:
---
<head>
  <meta name="referrer" content="no-referrer" />
</head>



## I/O系统基本概念

![image-20230921164325702](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921164325702.png)

I/O系统的任务是实现主机和外设的信息交换.采用总线方式互连时，外设必须通过**I/O接口**与总线连接

### I/O指令

<img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921163855567.png" alt="image-20230921163855567" style="zoom: 67%;float:left" />

其中操作码表示信息传送的方向，设备码表示目标设备地址，命令码表示信息传送类型及内容。I/O指令只有两种操作码，但是设备地址有多个，即一个I/O接口包含多个I/O端口。

### 外设编址方式

外设地址即为I/O端口的地址，由于外设和主存都连接在总线上，需要区分两类地址。

- 统一编址方式

  又称为存储器映射方式。I/O设备共享与主存储器相同的地址空间，意味着CPU可以使用普通的存储器访问指令来访问这些设备，而不需要专门的I/O指令。不易于扩展，地址译码也较复杂

- 独立编址方式

  I/O设备与主存储器拥有不同的地址空间，意味着CPU需要增设I/O指令。易扩展，地址译码简单，被较多使用

### 外设数据传送方式

主要关注数据传输的时机

- 无条件传送

  又称为同步传送方式，即CPU和外设间数据传送无任何限制

- 条件传送

  又称为异步传送方式，数据传送需要满足一定条件，例如只有当外设启动并且准备就绪才进行数据传送

## 外部设备

- 输入设备

  键盘，鼠标

- 输出设备

  显示器，打印机

- 辅存

  - 辅存的性能指标

    - 存储密度

      单位面积所能存储的二进制信息量。存储密度=道密度×位密度

      > 道密度是单位距离所含的道数，也即相邻两个道的距离的倒数。
      >
      > 位密度类似同理。

    - 平均寻址时间

      平均寻址时间=平均寻道时间(找磁道)+平均等待时间(找扇区)

      > 平均等待时间为磁盘转半圈的时间

    - 磁盘的平均访问时间

      平均访问时间=平均寻址时间+读/写时间

    - 数据传输率

      指单位时间辅存所能传送数据位数。即数据传输率=记录密度×转盘转速

      > 记录密度是指每道所含的二进制位数，单位是位数/道
      >
      > 转盘转速单位是转数/秒

  - 磁盘

    - 地址记录格式

      <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921173649069.png" alt="image-20230921173649069" style="zoom:67%;" />

      扇区是磁道最小物理存储单位，磁盘控制器寻址时，先定位磁道(柱面)，再定位为到盘面(磁头)，最后找到扇区。

    - 磁盘阵列RAID

      采用数据分块技术，将数据交错存放在不同磁盘，使它们并行工作来提高访问速度。
      
      **八级RAID标准**：
      
      - RAID0：数据分块盘(**无冗余**)
      
      - RAID1：数据**镜像**盘
      
      - RAID2：**位**交叉**海明**校验盘
      
      - RAID3：**位**交叉**奇偶**校验盘
      
      - RAID4：**块**交叉**专用**奇偶校验盘
      
      - RAID5：**块**交叉**分布式**奇偶校验盘
      
      - RAID6：**块**交叉**分布式双重(双维)**奇偶校验盘
      
      - RAID7：带**Cache**的RAID6
      
        > 2海计专分布

## I/O接口(I/O控制器)

- 定义

  I/O接口又称为I/O控制器，是外设与主机间连接电路。

  > I/O端口是指I/O接口中与总线交换信息的寄存器

- 基本结构

  ![image-20230921175427387](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921175427387.png)

- 功能
  - 数据缓冲
  - 操作中转
  - 状态检测
  - 通信控制
  - 信号转换

## I/O方式

即CPU对I/O数据的传送控制方式，关注的是如何启动和控制数据传送。目的是尽可能提高I/O数据传输率，并减少I/O所占CPU时间.

### 程序查询方式

指I/O完全依靠程序实现，又称为轮询方式，CPU启动设备后，不断查询设备是否已经准备好传送，只有在设备就绪时，才进行数据传送。

CPU效率低。

根据查询的开始时间不同，可以分为：

- 独占查询

  启动设备后，立即开始查询，常用于启动时间较短的外设。

- 定时查询

  启动设备后，间隔一段时间才开始查询，常用于启动时间较长的外设。

### 程序中断方式

CPU继续启动设备后，就继续执行现行程序。等外设准备就绪后，外设主动向CPU提出中断请求，CPU响应处理最后返回现行程序。

CPU效率较高。

![image-20230921212724395](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921212724395.png)

#### 分类

- 可屏蔽中断和不可屏蔽中断

  可屏蔽中断即可以暂时不处理的中断，例如键盘打印机的I/O

  不可屏蔽中断即必须立即处理的中断，如电源故障

- 向量中断和非向量中断

  非向量中断，通过软件处理，所有事件共用一个中断处理程序

  向量中断，通过硬件处理，每个事件都对应一个中断处理程序，**不同处理程序的入口地址称为中断向量**，所有中断向量放在中断向量表IVT。

  ![image-20230921213322140](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921213322140.png)

  > 中断向量地址是不同处理程序的入口地址的地址

- 单重中断与多重中断

  单重中断在中断处理过程不再响应新的中断请求。

  ![image-20230921213514683](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921213514683.png)

  多重中断在中断处理过程可以响应新的中断请求，当新中断请求更紧急时，暂停正在执行中断，转去执行新中断程序。

  <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921213756912.png" alt="image-20230921213756912" style="zoom:67%;" />

  > 单重-多重中断方式的转化：
  >
  > 由于状态寄存器中的中断允许标志IF=0时，表示CPU暂时不响应可屏蔽中断，IF=1表示可以处理可屏蔽中断。故：
  >
  > ![image-20230921214013086](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921214013086.png)

#### 中断处理

![image-20230921214140762](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921214140762.png)

> PSW(Processor Status Word):程序状态寄存器

#### 中断返回

中断返回只能在程序中用中断返回指令IRET指明。

#### 中断屏蔽

中断屏蔽指的是可以屏蔽一些中断请求，来实现改变中断处理次序优先级的目标。中断寄存器使用屏蔽字MASK与中断请求号进行逻辑与操作。MASK_i(屏蔽字的第i位)=1时表示中断请求i被屏蔽。

### 直接存储器存取(DMA)方式

外设和主存间通过专门的DMA接口实现数据传送，无需CPU干预。只有传送准备和结束处理工作由CPU负责。适合快数据传送的外设。

CPU效率极高。

#### DMA传送方式

- CPU停止访问方式

  当DMA向CPU提出总线请求后，CPU放弃总线控制权，等到DMA全部数据传送结束，才释放总线控制权给CPU。

  ![image-20230921215647468](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921215647468.png)

  由图中可以看出DMA传送间隔期DMA和CPU都不工作，影响CPU的工作效率。

- 周期挪用(窃取)方式

  鉴于CPU停止访问方式的缺点，DMA在传送间隔期将总线控制权返回给CPU，下一次传送再重新拿回控制权。DMA总线请求的优先级高于CPU。CPU效率高。

  ![image-20230921220301147](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921220301147.png)

- 分时交替访问方式

  总线以时间片为单位，长度为一个主存存取周期，定时轮流的分配给CPU和DMA接口使用。DMA接口在自己的时间片内可以直接使用总线，不用申请和释放，由于DMA传送在不知不觉中完成，故该方式又称为透明DMA方式。

  > 三种DMA传送方式中，快速外设宜采用CPU停止访问方式，中速和慢速外设宜采用周期挪用方式，CPU速度较慢时宜使用分时交替方式

#### DMA接口结构

![image-20230921220822731](https://gitee.com/Marches7/piture-bed/raw/master/img/image-20230921220822731.png)

- 主存计数器MAC：存放交换数据在主存中的地址，初始值为主存缓冲区首地址，DMA传送过程中，每传送一个字MAC的内容将加1或减1
- 传送字计数器WC：用于存放尚未传送数据**字(节)数**，初始值为总字数，每传送一个字，WC内容减1
- 状态寄存器CR：接收CPU发来的I/O命令和有关控制信息。
- DMA控制逻辑：控制DMA的传送

#### DMA的传送过程

- 预处理

  由CPU设置本次DMA传送的参数，并启动外设。

- 数据传送

  CPU将控制操作委托给DMA控制器，由该控制器负责处理。DMA控制器直接与存储器交互，传送数据块，不需要CPU参与。传送完成后，DMA控制器发出一个中断信号给CPU

- 后处理

  CPU进行结束处理工作，如校验送入主存的数据是否正确。

> DMA方式与中断方式的区别：
>
> 1. 数据传送速度：中断方式通过软件进行，每次传输需要一个指令周期；而DMA通过硬件，只需一个总线周期。
> 2. CPU干预频率：中断方式每次传输都需要CPU介入；DMA只在传输开始和结束时需要。
> 3. 响应速度：中断方式响应较慢，DMA则更快且优先级更高。
> 4. 错误处理：中断方式能处理传输异常，DMA则不能。

## 提高部分

- 中断发生和响应

  <img src="https://gitee.com/Marches7/piture-bed/raw/master/img/image-20231125164859940.png" alt="image-20231125164859940" style="zoom:67%;" />

  