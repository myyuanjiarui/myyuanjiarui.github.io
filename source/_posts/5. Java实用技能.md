---
title: Java实用技能
date: 2024-08-06 17:49 
tags:
---
<head>
  <meta name="referrer" content="no-referrer" />
</head>


# 日期与时间

Java标准库中有新旧两套处理日期和时间的API：

- 旧API：定义在`java.util`中，主要包括`Date`，`Calendar`和`TimeZone`这几个类
- 新API：定义在`java.time`中，主要包括`LocalDateTime`，`ZonedDateTime`和`ZondeId`等

我们应坚持使用新API，旧的API因为历史遗留问题，也要过渡到新API使用。

- LocalDateTime

  获取当前日期与时间，默认按照ISO 8681规定的格式打印

  ```java
  LocalDateTime dt = LocalDateTime.now(); 
  ```

  如果要自定义格式化，则需要使用`DateTimeFormatter`库

  ```java
  DateTimeFormatter dtf = DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm:ss");
  System.out.println(dtf.format(LocalDateTime.now()));
  ```

  对日期就可以进行加减，并且支持链式调用

  ```java
  LocalDateTime dt2 = dt.plusDay(5).minusHours(3);
  ```

- ZonedDateTime

  `LocalDateTime`总是表示本地日期和时间，要表示一个带时区的日期和时间，我们就需要`ZonedDateTime`。

  获取默认时区和指定时区的时间：

  ```java
  ZonedDateTime zbj = ZonedDateTime.now(); // 默认时区
  ZonedDateTime zny = ZonedDateTime.now(ZoneId.of("America/New_York"));
  ```

  也可以通过给一个`LocalDateTime`加一个`ZoneId`参数，变成`ZonedDateTime`：

  ```java
  ZonedDateTime zbj = dt.atZone(ZoneId.of("America/New_York"));
  ```

  时区转换可以使用`withZoneSameInstant()`，下面展示了将中国时区的时间转换成纽约时间：

  ```java
  ZonedDateTime zbj = ZonedDateTime.now(ZoneId.of("Asia/Shanghai"));
  ZonedDateTime zny = zbj.withZoneSameInstant(ZoneId.of("America/New_York"));
  ```

  > [!CAUTION]
  >
  > 涉及到时区转换时，不要自己计算时差，否则很难正确处理夏令时

- Instant

  计算机存储的当前时间，实际上就是一个不断递增的整数。从1970年1月1日的格林威治时间为0，逐秒递增。

  返回当前计算机的时间戳：

  ```java
  System.out.println(System.currentTimeMillis());
  ```

  该时间戳在`java.time`中以`Instant`表示，也可以用`Instant.now()`获取当前的时间戳：

  ```java
  Instant now = Instant.now();
  System.out.println(now.getEpochSecond()); // 精确到秒
  ```

  使用时间戳常见当前时区的`ZonedDateTime`：

  ```java
  ZonedDateTime = now.atZone(ZoneId.systemDefault());
  ```

- 新旧API的转换：

  通过中间变量`Instant`对象即可实现转换。





